<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Whack A Mole!</title>
        <link
            href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700"
            rel="stylesheet"
            type="text/css"
        />
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <h1>Whack-a-mole! <span class="score">0</span></h1>
        <button onClick="startGame()">Start!</button>

        <div class="game">
            <div class="hole hole1">
                <div class="mole"></div>
            </div>
            <div class="hole hole2">
                <div class="mole"></div>
            </div>
            <div class="hole hole3">
                <div class="mole"></div>
            </div>
            <div class="hole hole4">
                <div class="mole"></div>
            </div>
            <div class="hole hole5">
                <div class="mole"></div>
            </div>
            <div class="hole hole6">
                <div class="mole"></div>
            </div>
        </div>

        <script>
            const minimumTimeout = 200;
            const maximumTimeout = 1000;
            const gameDurationInSeconds = 10;

            const holes = [...document.querySelectorAll('.hole')];
            const scoreBoard = document.querySelector('.score');
            const moles = document.querySelectorAll('.mole');

            let gameEndTime;
            let hideMoleTimeout;
            let showMoleTimeout;

            function showNextMole(previousHoleIndex) {
                if (Date.now() >= gameEndTime) {
                    return;
                }

                if (holes.some(h => h.classList.contains('up'))) {
                    return;
                }

                let holeIndex = Math.floor(Math.random() * holes.length);
                while (holeIndex === previousHoleIndex) {
                    holeIndex = Math.floor(Math.random() * holes.length);
                }
                const moleTimeout =
                    Math.floor(
                        Math.random() * (maximumTimeout - minimumTimeout + 1)
                    ) + minimumTimeout;

                moles[holeIndex].addEventListener(
                    'click',
                    function() {
                        scoreBoard.textContent = ++scoreBoard.textContent;

                        hideMole(holeIndex);
                        clearTimeout(hideMoleTimeout);

                        clearTimeout(showMoleTimeout);
                        showNextMole(holeIndex);
                    },
                    { once: true }
                );

                holes[holeIndex].classList.add('up');

                hideMoleTimeout = setTimeout(hideMole, moleTimeout, holeIndex);
                showMoleTimeout = setTimeout(
                    showNextMole,
                    moleTimeout,
                    holeIndex
                );
            }

            function hideMole(holeIndex) {
                holes[holeIndex].classList.remove('up');
            }

            function startGame() {
                clearTimeout(showMoleTimeout);
                clearTimeout(hideMoleTimeout);
                for (let i = 0; i < holes.length; i++) {
                    hideMole(i);
                }

                gameEndTime = Date.now() + gameDurationInSeconds * 1000;
                scoreBoard.textContent = 0;
                showNextMole();
            }
        </script>
    </body>
</html>
